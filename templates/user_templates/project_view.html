{% extends 'base.html' %}\

{% block head %}{% endblock %}

{% block body %}
    <div class="container">
        <div class="row">
            <div class="col-12">
                <a href="/dashboard">
                    <button>
                        <span class="material-symbols-outlined">
                            arrow_left_alt
                        </span>
                    </button>
                </a>
            </div>
        </div>
        <div class="row" >
            <div class="col-6">
                <h1>{{ username }} Project View</h1>
                <h5>Description: {{ project_view_data.description }}</h5>
                <h5>Location: {{ project_view_data.project_location }}</h5>
                <p>Date: {{ project_view_data.date }}</p>
            </div>
        </div>
        <!-- Content Viewer -->
        <div class="row">
            <div class="col-12">
                <div class="col-12 rounded-top" style="text-align: center; background-color: rgb(216, 188, 105);">
                    <button class="btn bg-dark m-2" style="color: white;" onclick="switchViewer('tour360')">Virtual Tour</button>
                    <button id="model3d_button" class="btn bg-dark m-2" style="color: white;" onclick="switchViewer('model3D')">3D Model</button>
                    <button class="btn bg-dark m-2" style="color: white;" onclick="switchViewer('ortho2D')">2D Orthomosaic</button>
                    <button class="btn bg-dark m-2" style="color: white;" onclick="switchViewer('video')">Video</button>
                    <button class="btn bg-dark m-2" style="color: white;" onclick="switchViewer('stills')">Still Images</button>
                </div>
                <div class="row">
                    <div class="col-12" id="viewer_container" style="background-color: slategray;">
                        <p>Viewer type:</p>
                        <!-- Virtual Tour -->
                        <!-- 3D Model -->
                        <!-- 2D Orthomosaic -->
                        <!-- Videography -->
                    </div>
                </div>
            </div>
        </div>
      <!-- Project View Script -->
      <script>
          const container = document.getElementById('viewer_container');

          // Switch Content display type
          function switchViewer(viewerType) {

              switch (viewerType) {
                case 'tour360':
                    container.innerHTML = ''; //Clear previous content
                    var para = document.createElement("h5");
                    para.style.textAlign = 'center';
                    var node = document.createTextNode("Virtual Tour");
                    para.appendChild(node);

                    container.appendChild(para);
                    break;
                case 'model3D':
                    container.innerHTML = ''; //Clear previous content
                    var para = document.createElement("h5");
                    para.style.textAlign = 'center';
                    var node = document.createTextNode("3D Model View");
                    para.appendChild(node);
                    container.appendChild(para);

                    // display model view button as selected.
                    const button = document.getElementById('model3d_button');
                    button.classList.add('selected'); // left off here oct 3rd 2023

                    load3DModelViewer(container);
                    break;
                case 'ortho2D':
                    container.innerHTML = ''; //Clear previous content
                    var para = document.createElement("h5");
                    para.style.textAlign = 'center';
                    var node = document.createTextNode("2D OrthoMosaic View");
                    para.appendChild(node);

                    container.appendChild(para);
                    break;
                case 'video':
                    container.innerHTML = ''; //Clear previous content
                    var para = document.createElement("h5");
                    para.style.textAlign = 'center';
                    var node = document.createTextNode("Video View");
                    para.appendChild(node);

                    container.appendChild(para);
                    break;
                case 'stills':
                    container.innerHTML = ''; //Clear previous content
                    var para = document.createElement("h5");
                    para.style.textAlign = 'center';
                    var node = document.createTextNode("Still Image View");
                    para.appendChild(node);

                    container.appendChild(para);
                    break;

              }
          }

          // Set Default Viewer
          switchViewer('tour360');

          //3D Model Helper Functions
          function loadScript(src, callback) {
              const script = document.createElement('script');
              script.src = src;
              script.type = 'module'
              model_url = '{{ project_view_data.model3d_url }}'
              script.setAttribute('model_url',model_url); // dynamically load project url from database
              script.id = 'model_3d_script';
              document.head.appendChild(script);
          }

          function loadAsyncScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.async = true
            document.head.appendChild(script);
          }

          function addImportMap(mapContent) { 
              const script = document.createElement('script');
              script.type = 'importmap';
              script.textContent = JSON.stringify(mapContent);
              document.head.appendChild(script)
           }

          // Create View Loaders
          function load3DModelViewer(container_) {
            // Load Scripts and styles for 3D Model Viewer
            loadAsyncScript('https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js', function() {
                console.log('3D Model Helper Script Loaded')
              });
              
            const importMapContent = {
                "imports": {
                    "three": "https://unpkg.com/three@v0.154.0/build/three.module.js",
                    "three/addons/": "https://unpkg.com/three@v0.154.0/examples/jsm/"
                }
            }

            addImportMap(importMapContent);

            loadScript('/static/js_scripts/3d_model_viewer.js', function() {
                console.log('3D Model Viewer Script Loaded');
            });

              // Render 3D Model
              // create model-renderer-container div and append to container
              const renderer_container = document.createElement('div');
              renderer_container.id = 'model-renderer-container';
              console.log('3D model Viewer')
              container.appendChild(renderer_container);
              // create Model Viewer Canvas
              const viewer_canvas = document.createElement('canvas');
              viewer_canvas.id = 'Model-Viewer2';
              container.style.width = '100%';
              // Calculate Height based on 16:9 ratio
              const ratio = 9 / 16;
              const height = container.width * ratio;
              container.style.height = '${height}px';
              renderer_container.appendChild(viewer_canvas);
          }

          function load360TourViewer(container_) {
              // Load Scripts and styles for 360 Tour Viewer
              // Render 360 Tour
          }

          function loadOrtho2DViewer(container_) {
              // Load Scripts and styles for 2D ortho Viewer
              // Render 2D ortho
          }

          function loadVideoViewer(container_) {
              // Load Scripts and styles for Video Viewer

          }
      </script> 
        <div class="row">
            <div class="col-12" style="text-align: center;">
                <button class="btn bg-dark" style="color: white;">Download All Assets</button>
            </div>
        </div>
    </div>
{% endblock %}